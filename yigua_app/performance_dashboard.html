<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>性能监控Dashboard - 易卦APP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }
        
        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .metric-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
        }
        
        .metric-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
        }
        
        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .metric-target {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }
        
        .metric-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-success {
            background: #10b981;
            color: white;
        }
        
        .status-warning {
            background: #f59e0b;
            color: white;
        }
        
        .status-error {
            background: #ef4444;
            color: white;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .progress-success {
            background: linear-gradient(90deg, #10b981, #34d399);
        }
        
        .progress-warning {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
        }
        
        .progress-error {
            background: linear-gradient(90deg, #ef4444, #f87171);
        }
        
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }
        
        canvas {
            max-width: 100%;
            height: auto;
        }
        
        .optimization-tips {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .tip-item {
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            background: #f9fafb;
            border-radius: 4px;
        }
        
        .tip-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .tip-description {
            color: #666;
            font-size: 0.9em;
            line-height: 1.5;
        }
        
        .real-time-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            margin-right: 5px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
            }
        }
        
        .control-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .control-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-warning {
            background: #f59e0b;
            color: white;
        }
        
        .time-range {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 15px;
        }
        
        select {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 性能监控Dashboard</h1>
        
        <!-- 控制面板 -->
        <div class="control-panel">
            <div class="control-buttons">
                <button class="btn btn-primary" onclick="refreshData()">刷新数据</button>
                <button class="btn btn-success" onclick="runBenchmark()">运行基准测试</button>
                <button class="btn btn-warning" onclick="optimizeSystem()">一键优化</button>
            </div>
            <div class="time-range">
                <label>时间范围:</label>
                <select id="timeRange" onchange="updateTimeRange()">
                    <option value="1h">最近1小时</option>
                    <option value="6h">最近6小时</option>
                    <option value="24h" selected>最近24小时</option>
                    <option value="7d">最近7天</option>
                </select>
                <span class="real-time-indicator"></span>
                <span style="color: #666; font-size: 0.9em;">实时监控中</span>
            </div>
        </div>
        
        <!-- 性能指标卡片 -->
        <div class="dashboard-grid">
            <!-- PDF处理性能 -->
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">PDF批处理</div>
                    <div class="metric-icon" style="background: #eef2ff; color: #667eea;">📄</div>
                </div>
                <div class="metric-value" id="pdfThroughput" style="color: #667eea;">0</div>
                <div class="metric-target">目标: 200文件/小时</div>
                <span class="metric-status status-warning" id="pdfStatus">检测中</span>
                <div class="progress-bar">
                    <div class="progress-fill progress-warning" id="pdfProgress" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- SQLite查询性能 -->
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">SQLite查询</div>
                    <div class="metric-icon" style="background: #f0fdf4; color: #10b981;">🗄️</div>
                </div>
                <div class="metric-value" id="sqliteLatency" style="color: #10b981;">0ms</div>
                <div class="metric-target">目标: <5ms (P95)</div>
                <span class="metric-status status-success" id="sqliteStatus">正常</span>
                <div class="progress-bar">
                    <div class="progress-fill progress-success" id="sqliteProgress" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- Flutter渲染性能 -->
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">Flutter渲染</div>
                    <div class="metric-icon" style="background: #fef3c7; color: #f59e0b;">📱</div>
                </div>
                <div class="metric-value" id="flutterFPS" style="color: #f59e0b;">0fps</div>
                <div class="metric-target">目标: 60fps</div>
                <span class="metric-status status-warning" id="flutterStatus">优化中</span>
                <div class="progress-bar">
                    <div class="progress-fill progress-warning" id="flutterProgress" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- 数据压缩性能 -->
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">数据压缩</div>
                    <div class="metric-icon" style="background: #fce7f3; color: #ec4899;">🗜️</div>
                </div>
                <div class="metric-value" id="compressionRatio" style="color: #ec4899;">0x</div>
                <div class="metric-target">目标: 37x (3.7GB→100MB)</div>
                <span class="metric-status status-error" id="compressionStatus">待优化</span>
                <div class="progress-bar">
                    <div class="progress-fill progress-error" id="compressionProgress" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- 缓存命中率 -->
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">缓存命中率</div>
                    <div class="metric-icon" style="background: #e0e7ff; color: #6366f1;">⚡</div>
                </div>
                <div class="metric-value" id="cacheHitRate" style="color: #6366f1;">0%</div>
                <div class="metric-target">目标: >90%</div>
                <span class="metric-status status-success" id="cacheStatus">良好</span>
                <div class="progress-bar">
                    <div class="progress-fill progress-success" id="cacheProgress" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- 内存使用 -->
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">内存使用</div>
                    <div class="metric-icon" style="background: #fef2f2; color: #ef4444;">💾</div>
                </div>
                <div class="metric-value" id="memoryUsage" style="color: #ef4444;">0GB</div>
                <div class="metric-target">可用: <span id="availableMemory">0GB</span></div>
                <span class="metric-status status-success" id="memoryStatus">正常</span>
                <div class="progress-bar">
                    <div class="progress-fill progress-success" id="memoryProgress" style="width: 0%"></div>
                </div>
            </div>
        </div>
        
        <!-- 实时性能图表 -->
        <div class="chart-container">
            <div class="chart-title">实时性能趋势</div>
            <canvas id="performanceChart" width="400" height="150"></canvas>
        </div>
        
        <!-- 优化建议 -->
        <div class="optimization-tips">
            <h2 style="margin-bottom: 20px; color: #333;">🎯 优化建议</h2>
            
            <div class="tip-item">
                <div class="tip-title">PDF批处理优化</div>
                <div class="tip-description">
                    当前配置: <span id="pdfWorkers">16</span>个工作进程<br>
                    建议: 使用内存映射(mmap)和批量处理，启用LZ4压缩中间结果
                </div>
            </div>
            
            <div class="tip-item">
                <div class="tip-title">SQLite查询优化</div>
                <div class="tip-description">
                    已启用: WAL模式, 64MB缓存, 内存临时表<br>
                    建议: 创建覆盖索引，使用批量IN查询替代多次单查询
                </div>
            </div>
            
            <div class="tip-item">
                <div class="tip-title">Flutter渲染优化</div>
                <div class="tip-description">
                    推荐: ListView.builder + RepaintBoundary<br>
                    缓存范围: 500像素，启用虚拟滚动和懒加载
                </div>
            </div>
            
            <div class="tip-item">
                <div class="tip-title">数据压缩策略</div>
                <div class="tip-description">
                    推荐算法: ZSTD级别19 (高压缩模式)<br>
                    预处理: 数据去重 + 增量编码 + 字典训练<br>
                    预期效果: 35-40x压缩率，15分钟完成3.7GB数据
                </div>
            </div>
            
            <div class="tip-item">
                <div class="tip-title">缓存层次设计</div>
                <div class="tip-description">
                    L1: 内存LRU缓存 (512MB)<br>
                    L2: Redis缓存 (2GB, LZ4压缩)<br>
                    L3: SQLite磁盘缓存 (5GB, ZSTD压缩)<br>
                    CDN: 静态资源30天缓存
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // 模拟性能数据
        let performanceData = {
            labels: [],
            datasets: [
                {
                    label: 'PDF吞吐量',
                    data: [],
                    borderColor: '#667eea',
                    tension: 0.4
                },
                {
                    label: 'SQLite响应',
                    data: [],
                    borderColor: '#10b981',
                    tension: 0.4
                },
                {
                    label: 'Flutter FPS',
                    data: [],
                    borderColor: '#f59e0b',
                    tension: 0.4
                }
            ]
        };
        
        // 初始化数据
        function initializeData() {
            // 生成初始数据点
            for (let i = 0; i < 20; i++) {
                const time = new Date(Date.now() - (20 - i) * 60000);
                performanceData.labels.push(time.toLocaleTimeString());
                performanceData.datasets[0].data.push(150 + Math.random() * 100); // PDF
                performanceData.datasets[1].data.push(2 + Math.random() * 4); // SQLite
                performanceData.datasets[2].data.push(50 + Math.random() * 15); // Flutter
            }
            
            updateMetrics();
        }
        
        // 更新指标显示
        function updateMetrics() {
            // PDF处理
            const pdfValue = 180 + Math.random() * 40;
            document.getElementById('pdfThroughput').textContent = `${pdfValue.toFixed(0)}文件/小时`;
            document.getElementById('pdfProgress').style.width = `${Math.min(pdfValue / 200 * 100, 100)}%`;
            updateStatus('pdf', pdfValue >= 200);
            
            // SQLite查询
            const sqliteValue = 3 + Math.random() * 3;
            document.getElementById('sqliteLatency').textContent = `${sqliteValue.toFixed(1)}ms`;
            document.getElementById('sqliteProgress').style.width = `${Math.max(0, 100 - sqliteValue * 20)}%`;
            updateStatus('sqlite', sqliteValue < 5);
            
            // Flutter渲染
            const flutterValue = 55 + Math.random() * 10;
            document.getElementById('flutterFPS').textContent = `${flutterValue.toFixed(0)}fps`;
            document.getElementById('flutterProgress').style.width = `${Math.min(flutterValue / 60 * 100, 100)}%`;
            updateStatus('flutter', flutterValue >= 60);
            
            // 数据压缩
            const compressionValue = 30 + Math.random() * 15;
            document.getElementById('compressionRatio').textContent = `${compressionValue.toFixed(0)}x`;
            document.getElementById('compressionProgress').style.width = `${Math.min(compressionValue / 37 * 100, 100)}%`;
            updateStatus('compression', compressionValue >= 37);
            
            // 缓存命中率
            const cacheValue = 85 + Math.random() * 10;
            document.getElementById('cacheHitRate').textContent = `${cacheValue.toFixed(0)}%`;
            document.getElementById('cacheProgress').style.width = `${cacheValue}%`;
            updateStatus('cache', cacheValue >= 90);
            
            // 内存使用
            const memoryUsed = 2.5 + Math.random() * 2;
            const memoryTotal = 8;
            document.getElementById('memoryUsage').textContent = `${memoryUsed.toFixed(1)}GB`;
            document.getElementById('availableMemory').textContent = `${(memoryTotal - memoryUsed).toFixed(1)}GB`;
            document.getElementById('memoryProgress').style.width = `${memoryUsed / memoryTotal * 100}%`;
            updateStatus('memory', memoryUsed < memoryTotal * 0.8);
            
            // CPU核心数
            document.getElementById('pdfWorkers').textContent = navigator.hardwareConcurrency * 2 || 16;
        }
        
        // 更新状态显示
        function updateStatus(metric, isGood) {
            const statusElement = document.getElementById(`${metric}Status`);
            const progressElement = document.getElementById(`${metric}Progress`);
            
            if (isGood) {
                statusElement.className = 'metric-status status-success';
                statusElement.textContent = '正常';
                progressElement.className = 'progress-fill progress-success';
            } else if (metric === 'compression') {
                statusElement.className = 'metric-status status-error';
                statusElement.textContent = '需优化';
                progressElement.className = 'progress-fill progress-error';
            } else {
                statusElement.className = 'metric-status status-warning';
                statusElement.textContent = '优化中';
                progressElement.className = 'progress-fill progress-warning';
            }
        }
        
        // 刷新数据
        function refreshData() {
            updateMetrics();
            console.log('数据已刷新');
            
            // 显示通知
            showNotification('数据已更新', 'success');
        }
        
        // 运行基准测试
        function runBenchmark() {
            showNotification('基准测试开始运行...', 'info');
            
            // 模拟测试运行
            setTimeout(() => {
                updateMetrics();
                showNotification('基准测试完成!', 'success');
            }, 3000);
        }
        
        // 系统优化
        function optimizeSystem() {
            showNotification('正在应用优化配置...', 'info');
            
            setTimeout(() => {
                // 模拟优化后的改进
                document.getElementById('pdfThroughput').textContent = '210文件/小时';
                document.getElementById('sqliteLatency').textContent = '3.5ms';
                document.getElementById('flutterFPS').textContent = '60fps';
                document.getElementById('compressionRatio').textContent = '38x';
                
                // 更新所有状态为成功
                ['pdf', 'sqlite', 'flutter', 'compression', 'cache', 'memory'].forEach(metric => {
                    updateStatus(metric, true);
                });
                
                showNotification('优化完成! 所有指标达到目标', 'success');
            }, 2000);
        }
        
        // 显示通知
        function showNotification(message, type) {
            // 这里可以实现更复杂的通知系统
            console.log(`[${type}] ${message}`);
        }
        
        // 更新时间范围
        function updateTimeRange() {
            const range = document.getElementById('timeRange').value;
            console.log(`时间范围更新为: ${range}`);
            refreshData();
        }
        
        // 自动刷新
        setInterval(() => {
            updateMetrics();
            
            // 更新图表数据
            if (performanceData.labels.length > 20) {
                performanceData.labels.shift();
                performanceData.datasets.forEach(dataset => dataset.data.shift());
            }
            
            const now = new Date();
            performanceData.labels.push(now.toLocaleTimeString());
            performanceData.datasets[0].data.push(150 + Math.random() * 100);
            performanceData.datasets[1].data.push(2 + Math.random() * 4);
            performanceData.datasets[2].data.push(50 + Math.random() * 15);
        }, 5000);
        
        // 初始化
        window.onload = function() {
            initializeData();
        };
    </script>
</body>
</html>