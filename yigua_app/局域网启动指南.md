# 📱 易卦APP局域网连接指南

## 🚀 快速启动步骤

### 第一步：启动服务器

1. **打开命令行**（Windows Terminal或CMD）
2. **进入服务器目录**：
```bash
cd /mnt/d/desktop/appp/yigua_app/server
```

3. **安装依赖**（首次运行）：
```bash
npm install
```

4. **启动服务器**：
```bash
npm start
```

启动成功后会显示：
```
🚀 易卦服务器已启动！
📱 局域网访问地址: http://192.168.1.100:8888
💻 本地访问地址: http://localhost:8888
```

### 第二步：手机连接

1. **确保手机和电脑在同一WiFi网络**
2. **打开易卦APP**
3. **进入设置页面**
4. **选择"局域网连接"**
5. **输入电脑IP地址**（如：192.168.1.100）
6. **点击"测试连接"**

## 🔧 配置文件

### 创建APP配置文件
`lib/config/app_config.dart`:
```dart
class AppConfig {
  // 局域网服务器地址
  static String serverUrl = 'http://192.168.1.100:8888';
  
  // API端点
  static String apiBase = '$serverUrl/api';
  
  // 连接测试
  static String healthCheck = '$apiBase/health';
}
```

## 📊 测试连接

### 1. 电脑端测试
打开浏览器访问：
- http://localhost:8888/api/health
- http://localhost:8888/api/hexagrams

### 2. 手机端测试
手机浏览器访问：
- http://[电脑IP]:8888/api/health

## 🛠️ 常见问题解决

### 问题1：找不到电脑IP地址
**Windows系统**：
```bash
ipconfig
```
找到"无线局域网适配器 WLAN"下的"IPv4 地址"

**Mac/Linux系统**：
```bash
ifconfig
```
找到"inet"后面的地址

### 问题2：手机无法连接
1. **检查防火墙**：
   - Windows防火墙可能阻止连接
   - 临时关闭防火墙测试
   - 或添加8888端口例外

2. **检查网络**：
   - 确保在同一WiFi
   - 不要用访客网络
   - 关闭VPN

### 问题3：连接不稳定
- 使用5G WiFi
- 靠近路由器
- 减少干扰设备

## 📁 目录结构

```
yigua_app/
├── server/              # 局域网服务器
│   ├── server.js       # 服务器主文件
│   ├── package.json    # 依赖配置
│   └── setup-ngrok.sh  # 内网穿透脚本（可选）
├── assets/
│   └── data/
│       ├── hexagrams.json    # 卦象数据
│       └── calendar_data.json # 黄历数据
└── lib/
    └── services/
        └── data_service.dart  # 数据服务
```

## 🌐 高级功能

### 使用ngrok实现外网访问（可选）
```bash
# 安装ngrok
npm install -g ngrok

# 启动穿透
ngrok http 8888
```

### 批量导入数据
```javascript
// 在server.js中添加
app.post('/api/import', (req, res) => {
  const { hexagrams } = req.body;
  // 保存到文件
  fs.writeFileSync('hexagrams.json', JSON.stringify(hexagrams));
  res.json({ success: true });
});
```

## 📱 APP端集成代码

```dart
// lib/services/local_server_service.dart
import 'package:dio/dio.dart';

class LocalServerService {
  final dio = Dio();
  String baseUrl = '';
  
  // 设置服务器地址
  void setServerUrl(String ip) {
    baseUrl = 'http://$ip:8888/api';
  }
  
  // 测试连接
  Future<bool> testConnection() async {
    try {
      final response = await dio.get('$baseUrl/health');
      return response.data['status'] == 'ok';
    } catch (e) {
      return false;
    }
  }
  
  // 获取卦象数据
  Future<List> getHexagrams() async {
    final response = await dio.get('$baseUrl/hexagrams');
    return response.data;
  }
}
```

## ✅ 启动检查清单

- [ ] Node.js已安装（版本14+）
- [ ] npm依赖已安装
- [ ] 防火墙已配置
- [ ] 手机和电脑同一WiFi
- [ ] 服务器正常启动
- [ ] IP地址正确
- [ ] 测试连接成功

## 📞 技术支持

遇到问题时的调试步骤：
1. 检查服务器日志
2. 使用Postman测试API
3. 查看手机端错误信息
4. 检查网络抓包

---

**提示**：首次配置可能需要10-15分钟，配置成功后下次直接启动即可。