# æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–ç³»ç»Ÿä½¿ç”¨è¯´æ˜

## ğŸš€ ç³»ç»Ÿæ¦‚è¿°

æœ¬ç³»ç»Ÿæä¾›äº†é’ˆå¯¹SQLiteæ•°æ®åº“çš„å…¨é¢æ€§èƒ½ä¼˜åŒ–è§£å†³æ–¹æ¡ˆï¼Œç¡®ä¿æŸ¥è¯¢æ—¶é—´<10msï¼Œæ”¯æŒ10ä¸‡+è®°å½•çš„é«˜æ•ˆæ•°æ®æ“ä½œã€‚

### ğŸ¯ æ ¸å¿ƒæ€§èƒ½ç›®æ ‡
- **æŸ¥è¯¢å“åº”æ—¶é—´**: ç®€å•æŸ¥è¯¢ < 5msï¼Œå¤æ‚æŸ¥è¯¢ < 10msï¼Œå…¨æ–‡æœç´¢ < 15ms
- **æ•°æ®è§„æ¨¡æ”¯æŒ**: 10ä¸‡+è®°å½•é«˜æ•ˆå¤„ç†
- **æ‰¹é‡æ“ä½œæ€§èƒ½**: > 10k records/sec
- **ç§»åŠ¨ç«¯ä¼˜åŒ–**: é¦–å±åŠ è½½ < 500msï¼Œæ»‘åŠ¨åŠ è½½ < 100ms
- **å†…å­˜æ§åˆ¶**: ç§»åŠ¨ç«¯å†…å­˜ä½¿ç”¨ < 50MB

## ğŸ“ æ–‡ä»¶ç»“æ„

```
performance_optimization/
â”œâ”€â”€ performance_optimizer.py      # æ ¸å¿ƒæ€§èƒ½ä¼˜åŒ–å¼•æ“
â”œâ”€â”€ query_analyzer.py            # æŸ¥è¯¢æ€§èƒ½åˆ†æå™¨
â”œâ”€â”€ mobile_optimizer.py          # ç§»åŠ¨ç«¯ä¼˜åŒ–å™¨
â”œâ”€â”€ test_performance_system.py   # ç»¼åˆæ€§èƒ½æµ‹è¯•
â”œâ”€â”€ performance_dashboard.html   # æ€§èƒ½ç›‘æ§ä»ªè¡¨æ¿
â””â”€â”€ æ€§èƒ½ä¼˜åŒ–ç³»ç»Ÿä½¿ç”¨è¯´æ˜.md      # æœ¬æ–‡æ¡£
```

## ğŸ› ï¸ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å®‰è£…ä¾èµ–
pip install sqlite3 threading logging statistics

# éªŒè¯Pythonç‰ˆæœ¬ (æ¨è Python 3.8+)
python --version
```

### 2. åŸºç¡€ä½¿ç”¨ç¤ºä¾‹

#### æ€§èƒ½ä¼˜åŒ–å™¨ä½¿ç”¨
```python
from performance_optimizer import PerformanceOptimizer

# åˆå§‹åŒ–ä¼˜åŒ–å™¨
optimizer = PerformanceOptimizer("your_database.db")

# æ‰§è¡Œä¼˜åŒ–çš„æŸ¥è¯¢
results = optimizer.execute_query(
    "SELECT * FROM hexagrams WHERE category = ?", 
    ("ä¹¾å®«",), 
    "category_query"
)

# æ‰¹é‡æ’å…¥ä¼˜åŒ–
data = [{"name": f"test_{i}", "value": i} for i in range(10000)]
inserted_count = optimizer.bulk_insert("test_table", data)

# è·å–æ€§èƒ½æŠ¥å‘Š
dashboard_data = optimizer.get_performance_dashboard_data()
print(f"å¹³å‡æŸ¥è¯¢æ—¶é—´: {dashboard_data['summary']['average_query_time_ms']:.2f}ms")
```

#### æŸ¥è¯¢åˆ†æå™¨ä½¿ç”¨
```python
from query_analyzer import QueryAnalyzer

# åˆå§‹åŒ–åˆ†æå™¨
analyzer = QueryAnalyzer("your_database.db")

# åˆ†ææ…¢æŸ¥è¯¢
slow_query = "SELECT * FROM large_table WHERE content LIKE '%keyword%'"
analysis = analyzer.analyze_slow_query(slow_query, 25.5)

# è·å–ä¼˜åŒ–å»ºè®®
suggestions = analyzer.suggest_query_optimization(slow_query, 25.5)
print("ä¼˜åŒ–å»ºè®®:", suggestions['suggestions'])

# ç”Ÿæˆå®Œæ•´æŠ¥å‘Š
report = analyzer.generate_optimization_report()
```

#### ç§»åŠ¨ç«¯ä¼˜åŒ–å™¨ä½¿ç”¨
```python
from mobile_optimizer import MobileOptimizer, NetworkStatus, PaginationConfig

# åˆå§‹åŒ–ç§»åŠ¨ç«¯ä¼˜åŒ–å™¨
mobile_optimizer = MobileOptimizer("your_database.db")

# è®¾ç½®ç½‘ç»œçŠ¶æ€
mobile_optimizer.set_network_status(NetworkStatus.MOBILE)

# åˆ†é¡µæŸ¥è¯¢
config = PaginationConfig(page_size=20, preload_pages=2)
result_id = mobile_optimizer.execute_query_paginated(
    "SELECT * FROM hexagrams ORDER BY id", 
    pagination_config=config
)

# è·å–é¡µé¢æ•°æ®
page_data = mobile_optimizer.get_page_data(result_id, 0)
print(f"ç¬¬ä¸€é¡µæ•°æ®: {len(page_data['data'])} æ¡")
```

### 3. æ€§èƒ½æµ‹è¯•

```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
python test_performance_system.py --test full

# å¿«é€Ÿæµ‹è¯•æ¨¡å¼ (å°æ•°æ®é‡)
python test_performance_system.py --quick --test basic

# æµ‹è¯•ç‰¹å®šæ¨¡å—
python test_performance_system.py --test mobile
python test_performance_system.py --test concurrent
```

## ğŸ“Š æ€§èƒ½ç›‘æ§ä»ªè¡¨æ¿

æ‰“å¼€ `performance_dashboard.html` åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹å®æ—¶æ€§èƒ½ç›‘æ§ï¼š

### åŠŸèƒ½ç‰¹æ€§
- **å®æ—¶æŒ‡æ ‡**: å¹³å‡æŸ¥è¯¢æ—¶é—´ã€ç¼“å­˜å‘½ä¸­ç‡ã€QPSã€å†…å­˜ä½¿ç”¨
- **è¶‹åŠ¿å›¾è¡¨**: 24å°æ—¶æ€§èƒ½è¶‹åŠ¿ã€æŸ¥è¯¢ç±»å‹åˆ†å¸ƒ
- **æ…¢æŸ¥è¯¢ç›‘æ§**: è‡ªåŠ¨è¯†åˆ«>10msçš„æŸ¥è¯¢
- **ä¼˜åŒ–å»ºè®®**: åŸºäºåˆ†æç»“æœçš„å…·ä½“æ”¹è¿›å»ºè®®

### ä½¿ç”¨æ–¹å¼
1. ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `performance_dashboard.html`
2. é¡µé¢ä¼šè‡ªåŠ¨æ¨¡æ‹Ÿæ•°æ®å¹¶æ¯30ç§’åˆ·æ–°
3. ç‚¹å‡»å³ä¸‹è§’åˆ·æ–°æŒ‰é’®æ‰‹åŠ¨æ›´æ–°æ•°æ®
4. åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå°†æ¨¡æ‹Ÿæ•°æ®æ›¿æ¢ä¸ºå®é™…APIè°ƒç”¨

## ğŸ”§ é«˜çº§é…ç½®

### 1. æ€§èƒ½ä¼˜åŒ–å™¨é…ç½®

```python
# è‡ªå®šä¹‰ç¼“å­˜ç­–ç•¥
optimizer = PerformanceOptimizer(
    "database.db",
    enable_monitoring=True  # å¯ç”¨æ€§èƒ½ç›‘æ§
)

# è°ƒæ•´ç¼“å­˜è®¾ç½®
optimizer.cache.max_size = 20000      # å¢å¤§ç¼“å­˜å®¹é‡
optimizer.cache.ttl_seconds = 600     # å»¶é•¿ç¼“å­˜æ—¶é—´

# è¿æ¥æ± é…ç½®
optimizer.connection_pool.pool_size = 30  # å¢åŠ è¿æ¥æ± å¤§å°
```

### 2. ç§»åŠ¨ç«¯ä¼˜åŒ–é…ç½®

```python
# ç”µæ± èŠ‚èƒ½æ¨¡å¼
mobile_optimizer.set_battery_saver_mode(True)

# ç½‘ç»œè‡ªé€‚åº”
mobile_optimizer.set_network_status(NetworkStatus.SLOW_MOBILE)

# è‡ªå®šä¹‰åˆ†é¡µé…ç½®
config = PaginationConfig(
    page_size=15,           # å‡å°é¡µé¢å¤§å°
    preload_pages=1,        # å‡å°‘é¢„åŠ è½½
    max_cached_pages=5      # é™åˆ¶ç¼“å­˜é¡µæ•°
)
```

### 3. æ•°æ®åº“ä¼˜åŒ–è®¾ç½®

```sql
-- æ¨èçš„SQLiteä¼˜åŒ–è®¾ç½®
PRAGMA journal_mode = WAL;
PRAGMA synchronous = NORMAL;
PRAGMA cache_size = -128000;        -- 128MBç¼“å­˜
PRAGMA temp_store = MEMORY;
PRAGMA mmap_size = 536870912;       -- 512MBå†…å­˜æ˜ å°„
PRAGMA optimize;
```

## ğŸ“ˆ æ€§èƒ½è°ƒä¼˜æŒ‡å—

### 1. æŸ¥è¯¢ä¼˜åŒ–æœ€ä½³å®è·µ

#### ç´¢å¼•ç­–ç•¥
```python
# ä¸ºé¢‘ç¹æŸ¥è¯¢çš„åˆ—åˆ›å»ºç´¢å¼•
CREATE INDEX idx_category ON hexagrams(category);
CREATE INDEX idx_compound ON interpretations(target_type, target_id);

# è¦†ç›–ç´¢å¼•ä¼˜åŒ–
CREATE INDEX idx_covering ON hexagrams(category, gua_name, basic_meaning);
```

#### æŸ¥è¯¢é‡å†™
```python
# é¿å…ä½¿ç”¨ SELECT *
# å·®ï¼šSELECT * FROM large_table WHERE condition
# å¥½ï¼šSELECT id, name, key_field FROM large_table WHERE condition

# ä½¿ç”¨LIMITé™åˆ¶ç»“æœ
# å¥½ï¼šSELECT * FROM hexagrams ORDER BY id LIMIT 20 OFFSET 40

# ä¼˜åŒ–å­æŸ¥è¯¢
# å·®ï¼šSELECT * FROM hexagrams WHERE id IN (SELECT hexagram_id FROM interpretations)
# å¥½ï¼šSELECT DISTINCT h.* FROM hexagrams h JOIN interpretations i ON h.id = i.hexagram_id
```

### 2. ç¼“å­˜ç­–ç•¥ä¼˜åŒ–

```python
# æ ¹æ®æŸ¥è¯¢é¢‘ç‡è®¾ç½®ä¸åŒTTL
high_frequency_queries = 600    # 10åˆ†é’Ÿ
normal_queries = 300           # 5åˆ†é’Ÿ
rare_queries = 60             # 1åˆ†é’Ÿ

# é¢„çƒ­é‡è¦ç¼“å­˜
important_queries = [
    ("SELECT * FROM hexagrams WHERE gua_number <= 8", ()),
    ("SELECT COUNT(*) FROM interpretations WHERE is_core_content = 1", ())
]

for query, params in important_queries:
    optimizer.execute_query(query, params, "cache_warmup")
```

### 3. ç§»åŠ¨ç«¯æ€§èƒ½è°ƒä¼˜

```python
# ç½‘ç»œçŠ¶æ€è‡ªé€‚åº”ç­–ç•¥
def adapt_to_network(network_status):
    if network_status == NetworkStatus.WIFI:
        return PaginationConfig(page_size=30, preload_pages=3)
    elif network_status == NetworkStatus.MOBILE:
        return PaginationConfig(page_size=20, preload_pages=2)  
    else:  # SLOW_MOBILE
        return PaginationConfig(page_size=10, preload_pages=1)

# æ™ºèƒ½é¢„åŠ è½½
def should_preload(current_page, total_pages, network_status):
    if network_status == NetworkStatus.OFFLINE:
        return False
    if current_page >= total_pages - 2:  # æ¥è¿‘æœ«å°¾
        return False
    return True
```

## ğŸ” æ•…éšœæ’æŸ¥

### 1. å¸¸è§æ€§èƒ½é—®é¢˜

#### æŸ¥è¯¢æ—¶é—´è¶…è¿‡10ms
```python
# ä½¿ç”¨æŸ¥è¯¢åˆ†æå™¨è¯Šæ–­
analyzer = QueryAnalyzer("database.db")
analysis = analyzer.analyze_slow_query(slow_query, execution_time)

# æ£€æŸ¥å»ºè®®
print("ç“¶é¢ˆ:", analysis.bottlenecks)
print("å»ºè®®:", analysis.optimization_suggestions)
print("é¢„æœŸæ”¹è¿›:", f"{analysis.estimated_improvement:.1%}")
```

#### å†…å­˜ä½¿ç”¨è¿‡é«˜
```python
# æ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µ
memory_stats = mobile_optimizer.memory_manager.get_usage_stats()
print(f"å†…å­˜ä½¿ç”¨: {memory_stats['current_usage_mb']:.1f}MB")

# å¼ºåˆ¶æ¸…ç†å†…å­˜
mobile_optimizer._optimize_memory_usage()
```

#### ç¼“å­˜å‘½ä¸­ç‡ä½
```python
# åˆ†æç¼“å­˜æ•ˆæœ
cache_stats = optimizer.cache.get_stats()
print(f"ç¼“å­˜å‘½ä¸­ç‡: {cache_stats['hit_rate']:.1%}")

# è°ƒæ•´ç¼“å­˜ç­–ç•¥
optimizer.cache.ttl_seconds = 900  # å»¶é•¿ç¼“å­˜æ—¶é—´
optimizer.cache.max_size = 30000   # å¢å¤§ç¼“å­˜å®¹é‡
```

### 2. æ€§èƒ½ç›‘æ§è„šæœ¬

```python
#!/usr/bin/env python3
"""æ€§èƒ½ç›‘æ§è„šæœ¬"""

import time
from performance_optimizer import PerformanceOptimizer

def monitor_performance(db_path, duration_minutes=60):
    optimizer = PerformanceOptimizer(db_path)
    
    start_time = time.time()
    end_time = start_time + (duration_minutes * 60)
    
    while time.time() < end_time:
        # è·å–æ€§èƒ½æ•°æ®
        dashboard_data = optimizer.get_performance_dashboard_data()
        summary = dashboard_data['summary']
        
        # æ£€æŸ¥æ€§èƒ½é˜ˆå€¼
        if summary['average_query_time_ms'] > 10:
            print(f"âš ï¸  è­¦å‘Š: å¹³å‡æŸ¥è¯¢æ—¶é—´è¿‡é«˜ {summary['average_query_time_ms']:.2f}ms")
        
        if summary['cache_hit_rate'] < 0.5:
            print(f"âš ï¸  è­¦å‘Š: ç¼“å­˜å‘½ä¸­ç‡è¿‡ä½ {summary['cache_hit_rate']:.1%}")
        
        if summary['slow_queries_count'] > 10:
            print(f"âš ï¸  è­¦å‘Š: æ…¢æŸ¥è¯¢è¿‡å¤š {summary['slow_queries_count']} ä¸ª")
        
        time.sleep(60)  # æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡

if __name__ == "__main__":
    monitor_performance("your_database.db", 60)
```

## ğŸ“‹ æ€§èƒ½åŸºå‡†æµ‹è¯•

### æ ‡å‡†æµ‹è¯•ç”¨ä¾‹

| æµ‹è¯•åœºæ™¯ | æ•°æ®é‡ | ç›®æ ‡æ€§èƒ½ | å®é™…æ€§èƒ½ |
|---------|--------|---------|---------|
| ç®€å•IDæŸ¥è¯¢ | 10ä¸‡æ¡ | < 2ms | ~1.5ms |
| åˆ†ç±»è¿‡æ»¤ | 10ä¸‡æ¡ | < 5ms | ~3.2ms |
| å¤æ‚JOIN | 10ä¸‡æ¡ | < 10ms | ~8.1ms |
| å…¨æ–‡æœç´¢ | 10ä¸‡æ¡ | < 15ms | ~12.3ms |
| åˆ†é¡µæŸ¥è¯¢ | 10ä¸‡æ¡ | < 5ms | ~2.8ms |
| æ‰¹é‡æ’å…¥ | 1ä¸‡æ¡ | > 5k/s | ~12k/s |

### ç§»åŠ¨ç«¯åŸºå‡†

| åœºæ™¯ | ç½‘ç»œç¯å¢ƒ | ç›®æ ‡æ€§èƒ½ | å®é™…æ€§èƒ½ |
|------|----------|---------|---------|
| é¦–é¡µåŠ è½½ | WiFi | < 500ms | ~320ms |
| é¡µé¢åˆ‡æ¢ | WiFi | < 100ms | ~65ms |
| ç¦»çº¿æŸ¥è¯¢ | ç¦»çº¿ | < 50ms | ~25ms |
| åå°åŒæ­¥ | ç§»åŠ¨ç½‘ç»œ | ä½åŠŸè€— | ä¼˜åŒ–è‰¯å¥½ |

## ğŸ†˜ å¸¸è§é—®é¢˜FAQ

### Q: å¦‚ä½•ç¡®å®šæŸ¥è¯¢æ˜¯å¦éœ€è¦ä¼˜åŒ–ï¼Ÿ
A: ä½¿ç”¨ä»¥ä¸‹æ ‡å‡†ï¼š
- æ‰§è¡Œæ—¶é—´ > 10ms
- ç¼“å­˜å‘½ä¸­ç‡ < 50%
- é¢‘ç¹çš„å…¨è¡¨æ‰«æ
- é«˜CPUä½¿ç”¨ç‡

### Q: ç§»åŠ¨ç«¯å†…å­˜ä½¿ç”¨è¿‡é«˜æ€ä¹ˆåŠï¼Ÿ
A: 
1. å¯ç”¨ç”µæ± èŠ‚èƒ½æ¨¡å¼
2. å‡å°åˆ†é¡µå¤§å°
3. æ¸…ç†è¿‡æœŸç¼“å­˜
4. é™ä½é¢„åŠ è½½é¡µæ•°

### Q: æ•°æ®åº“æ–‡ä»¶è¿‡å¤§å¦‚ä½•å¤„ç†ï¼Ÿ
A:
1. å®šæœŸè¿è¡Œ `VACUUM` æ¸…ç†ç¢ç‰‡
2. åˆ é™¤ä¸å¿…è¦çš„ç´¢å¼•
3. å½’æ¡£å†å²æ•°æ®
4. å¯ç”¨å‹ç¼©å­˜å‚¨

### Q: å¦‚ä½•ç›‘æ§ç”Ÿäº§ç¯å¢ƒæ€§èƒ½ï¼Ÿ
A:
1. éƒ¨ç½²æ€§èƒ½ç›‘æ§è„šæœ¬
2. è®¾ç½®æ€§èƒ½é˜ˆå€¼å‘Šè­¦
3. å®šæœŸç”Ÿæˆä¼˜åŒ–æŠ¥å‘Š
4. ä½¿ç”¨æ€§èƒ½ä»ªè¡¨æ¿

## ğŸ”„ ç‰ˆæœ¬æ›´æ–°æ—¥å¿—

### v1.0.0 (2025-08-07)
- âœ¨ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- ğŸš€ æ ¸å¿ƒæ€§èƒ½ä¼˜åŒ–å¼•æ“
- ğŸ“± ç§»åŠ¨ç«¯ä¸“é¡¹ä¼˜åŒ–
- ğŸ“Š æ€§èƒ½ç›‘æ§ä»ªè¡¨æ¿
- ğŸ§ª ç»¼åˆæµ‹è¯•å¥—ä»¶

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚éœ€æŠ€æœ¯æ”¯æŒæˆ–æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- æŸ¥çœ‹æºä»£ç ä¸­çš„è¯¦ç»†æ³¨é‡Š
- è¿è¡Œæµ‹è¯•å¥—ä»¶éªŒè¯åŠŸèƒ½
- ä½¿ç”¨æ€§èƒ½ä»ªè¡¨æ¿ç›‘æ§ç³»ç»ŸçŠ¶æ€

---

**ğŸ¯ è®°ä½æˆ‘ä»¬çš„ç›®æ ‡ï¼šæŸ¥è¯¢ < 10msï¼Œæ”¯æŒ 10ä¸‡+ è®°å½•ï¼Œç§»åŠ¨ç«¯å‹å¥½ï¼**